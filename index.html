<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Russian Car Driver HD</title>
    <meta name="viewport" content="width=device-width">

    <!-- Existing CSS -->
    <link href="config/TemplateData56/style.css" rel="stylesheet">
    <link href="config/shared/style.css" rel="stylesheet">
    <link href="config/shared/gamebreak/gamebreak.css" rel="stylesheet">

    <!-- Scripts -->
    <script src="config/shared/lib.js" type="text/javascript"></script>
    <script src="config/shared/browser_detector.js" type="text/javascript"></script>
    <script src="config/shared/sound_enabler.js" type="text/javascript"></script>
    <script src="config/shared/metrika.js" type="text/javascript"></script>
    <script src="config/shared/gamebreak/gamebreak.js" type="text/javascript"></script>
    <script src="config/TemplateData56/game.js" type="text/javascript"></script>
    <script src="config/TemplateData56/responsive.js" type="text/javascript"></script>
    <script src="config/TemplateData56/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>

    <!-- LIVE BLURRED BACKGROUND CSS -->
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
      }

      /* Live mirrored blurred background */
      #blur-bg-live {
        position: fixed;
        inset: 0;
        z-index: -1;
        filter: blur(35px) brightness(0.55);
        transform: scale(1.25);
      }

      /* Background canvas */
      #mirror {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Center the game */
      #container {
        position: relative;
        z-index: 5;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .game-name {
        margin-top: 15px;
        color: white;
        font-size: 22px;
        font-family: Arial, sans-serif;
        text-align: center;
      }
    </style>
  </head>

  <body>

    <!-- LIVE BACKGROUND CANVAS -->
    <div id="blur-bg-live">
      <canvas id="mirror"></canvas>
    </div>

    <!-- GAME -->
    <div id="container" class="container webgl-content">
      <div id="gameContainer" style="width: 960px; height: 540px;"></div>
      <h1 class="game-name">Russian Car Driver HD</h1>
    </div>

    <!-- UNITY INIT -->
    <script>
      var gameInstance = UnityLoader.instantiate(
        "gameContainer",
        "Build/rcd_hd_sept_26.json",
        {
          onProgress: UnityProgress,
          Module: {
            onRuntimeInitialized: function () {
              UnityProgress(gameInstance, "complete");
            }
          }
        }
      );
    </script>

    <!-- LIVE BACKGROUND MIRROR SCRIPT -->
    <script>
      const mirror = document.getElementById("mirror");
      const ctx = mirror.getContext("2d");

      let gameCanvas = null;

      function findGameCanvas() {
        const canvas = document.querySelector("#gameContainer canvas");
        if (canvas) {
          gameCanvas = canvas;
        } else {
          requestAnimationFrame(findGameCanvas);
        }
      }

      findGameCanvas();

      function updateMirror() {
        if (gameCanvas) {
          mirror.width = window.innerWidth;
          mirror.height = window.innerHeight;
          try {
            ctx.drawImage(gameCanvas, 0, 0, mirror.width, mirror.height);
          } catch (e) {
            // Canvas not ready yet; retry silently
          }
        }
        requestAnimationFrame(updateMirror);
      }

      updateMirror();
    </script>

  </body>
</html>
